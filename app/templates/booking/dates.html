<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Time Slots</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f9;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .date {
            padding: 10px;
            text-align: center;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        .date.inactive {
            background: #ddd;
            cursor: not-allowed;
        }

        .list-times {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .time-button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .time-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<h1>Choose a Date and Time</h1>

<div id="calendarContainer" class="calendar">
    <!-- Calendar dates will be dynamically loaded here -->
</div>

<div id="timeContainer">
    <!-- Time slots will be dynamically displayed here -->
</div>

<script>
    const staffId = "{{ staff_id }}"

    const loadCalendar = () => {
        const calendarContainer = document.getElementById('calendarContainer');
        const today = new Date();
        const datesToShow = 30; // Number of days to show in the calendar

        for (let i = 0; i < datesToShow; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);

            const dateElement = document.createElement('div');
            dateElement.className = 'date';
            dateElement.dataset.date = date.toISOString().split('T')[0];
            dateElement.textContent = date.toLocaleDateString('en-GB', {
                day: '2-digit', month: 'short', year: 'numeric'
            });

            if (isWeekend(date)) {
                dateElement.classList.add('inactive');
            } else {
                dateElement.addEventListener('click', () => loadTimeSlots(dateElement.dataset.date));
            }

            calendarContainer.appendChild(dateElement);
        }
    };

    const isWeekend = (date) => {
        const day = date.getDay();
        return day === 0 || day === 6; // Sunday or Saturday
    };

    const getTimes = async (staffID, selectDate) => {
        try {

            const payload = {
                staff_id: staffID,
                select_date: selectDate,
                available_times: []
            }

            return fetch('/book_record/category/services/{{ service_id }}/times', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

        } catch (e) {
            console.log("Ошибка при GET:", e)
        }
    }

    const loadTimeSlots = async (selectedDate) => {
        const timeContainer = document.getElementById('timeContainer');
        timeContainer.innerHTML = ''; // Clear previous times

        const title = document.createElement('h2');
        title.textContent = `Available Times for ${selectedDate}`;
        timeContainer.appendChild(title);

        const listTimesContainer = document.createElement('div');
        listTimesContainer.className = 'list-times';

        // Example time slots (replace with server call for real data)
        const response = await getTimes(staffId, selectedDate);
        let times = await response.json();

        console.log(times.available_times)

        if (times.available_times && times.available_times.length !== 0) {
            //await viewTimes(times.available_times, dateId);
            const timeSlots = times.available_times

            timeSlots.forEach((time) => {
                const timeButton = document.createElement('button');
                timeButton.className = 'time-button';
                timeButton.textContent = time;
                timeButton.addEventListener('click', () => alert(`You selected ${time} on ${selectedDate}`));
                listTimesContainer.appendChild(timeButton);
            });

            timeContainer.appendChild(listTimesContainer);

        } else {
            const mb3 = document.getElementById('timeContainer');

            const wrapper = document.createElement('div')
            wrapper.innerHTML = [
                `<div class="alert alert-primary alert-dismissible" role="alert">`,
                `   <div>Для выбранной даты отсутсвует время для записи.</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('')
            mb3.textContent = '';
            mb3.append(wrapper);

        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        loadCalendar();
    });
</script>

</body>
</html>
