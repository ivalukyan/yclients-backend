<head>
    <!-- Остальные метатеги и стили -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar">
    <a href="/book_record/category/services/{{ service_id }}" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left"
             viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                  d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
        </svg>
    </a>
    <h3>Выбрать Дату</h3>
</nav>
<div class="container" id="containerId">
    <div class="mb-3" id="mb3Id">
        <label class="form-label" for="idDateInput">Выберите дату записи</label>
        <input name="date" class="form-control" id="idDateInput" style="color: #f8f8f8;">
        <div id="liveAlertPlaceholder"></div>
    </div>
    <div id="timeContainer"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script>
    // Инициализация Flatpickr
    document.addEventListener('DOMContentLoaded', function () {
        const dateInput = document.getElementById('idDateInput');
        const today = new Date();

        flatpickr(dateInput, {
            minDate: today,
            dateFormat: "Y-m-d",
            onChange: function (selectedDates, dateStr, instance) {
                // Обработка изменения даты
                selectDate();
            },
            locale: "ru" // Локализация календаря
        });

        // Загрузка времени при загрузке страницы
        selectDate();
    });

    // Остальной JavaScript-код для получения времени
    const selectDate = async () => {
        let dateId = document.getElementById('idDateInput').value.trim();

        console.log(`Выбранная дата: ${dateId}`);

        const response = await getTimes(staffId, dateId);
        let times = await response.json();

        console.log(times.available_times);

        if (times.available_times && times.available_times.length !== 0) {
            await viewTimes(times.available_times, dateId);
        } else {
            const mb3 = document.getElementById('timeContainer');

            const wrapper = document.createElement('div');
            wrapper.innerHTML = [
                `<div class="alert alert-primary alert-dismissible" role="alert">`,
                `   <div>Для выбранной даты отсутсвует время для записи.</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('');
            mb3.textContent = '';
            mb3.append(wrapper);

            console.log("Время записи отсутствует");
        }
    };
</script>
</body>
